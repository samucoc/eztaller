
                                                                            
 #    #   ##   #####  # #####   ##   #####  # #      # #####    ##   #####
 #    #  #  #  #    # #   #    #  #  #    # # #      # #    #  #  #  #    #
 ###### #    # #####  #   #   #    # #####  # #      # #    # #    # #    #
 #    # ###### #    # #   #   ###### #    # # #      # #    # ###### #    #
 #    # #    # #    # #   #   #    # #    # # #      # #    # #    # #    #
 #    # #    # #####  #   #   #    # #####  # ###### # #####  #    # #####

Everis															 19-12-2019


================
 INSTALACIÓN v1
================

I. Configuracion servidor Apache
=================================

1. Habilitar el puerto 8000. 
	Modificar '/etc/httpd/conf/httpd.conf' y agregar: Listen 8000
	Ejemplo en el Anexo 1.


2. Configurar virtual host. '/etc/httpd/vhost.d/vhost-habitabilidad.conf'
	Ejemplo en el Anexo 2.



II. Habitabilidad
==================

1. Requerimientos (ejecutar los faltantes)

	a. Directorios
	--------------
	mkdir -p /var/www/html/habitabilidad/backend/
	mkdir -p /var/www/html/habitabilidad/frontend/

	b. NodeJS
	---------
	curl -sL https://rpm.nodesource.com/setup_10.x | sudo bash -
	yum install nodejs

	c. Composer
	-----------
	curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

	d. Módulo PHP PostgresSQL
	-----------------------
	yum install php-pgsql
	systemctl restart httpd

	e. Módulo PHP soap
	------------------
	yum install php-soap
	systemctl restart httpd	


2. Backend

	a. Descargar fuente
		cd /var/www/html/habitabilidad/backend/
		git clone -b master https://gitlab.mds.cl/dpps/habitalidad_backend.git .

	b. Configurar variables de entorno
		Editar el archivo: /var/www/html/habitabilidad/backend/.env.example 
		Modificar la ruta de la aplicación backend según el hostname de la máquina y
			los datos de conexión a las bases de datos.

		Copiar el archivo en la misma ruta con el nombre '.env'
			cp /var/www/html/habitabilidad/backend/.env.example /var/www/html/habitabilidad/backend/.env

	c. Instalar dependencias
		composer install

	d. Crear tablas en bbdd y poblar con datos de prueba
		php artisan:refresh --seed

	
3. Front end

	a. Descargar fuente
		cd /var/www/html/habitabilidad/frontend/
		git clone -b master https://gitlab.mds.cl/dpps/habitabilidad_frontend.git .

	b. Instalar dependencias
		npm install

	c. Configurar variables de entorno
		Editar el archivo: /var/www/html/habitabilidad/frontend/.env.example 
		Modificar la ruta de la aplicación backend según el hostname de la máquina.

		Copiar el archivo en la misma ruta con el nombre '.env'
			cp /var/www/html/habitabilidad/frontend/.env.example /var/www/html/habitabilidad/frontend/.env		

	c. Construir aplicacion
		npm run build



III. ANEXOS
============

1. httpd.conf

.
.
# prevent Apache from glomming onto all bound IP addresses.
#
#Listen 12.34.56.78:80
Listen 80
Listen 8000

#
# Dynamic Shared Object (DSO) Support
.
.


2. vhost-habitabilidad.conf

<VirtualHost *:8000>
    ServerAdmin operaciones@desarrollosocial.cl
    DocumentRoot /var/www/html/habitabilidad/backend/public
    ServerName habitabilidad.mideplan.cl
    ServerAlias habitabilidad.mideplan.cl
    ErrorLog logs/habitabilidad.mideplan.cl-error_log
    CustomLog logs/habitabilidad.mideplan.cl-access_log common
    Options Indexes FollowSymLinks

    <Directory "/var/www/html/habitabilidad/backend/public">
        AllowOverride All
        <IfVersion < 2.4>
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
    </Directory>
</VirtualHost>

<VirtualHost *:80>
    ServerAdmin operaciones@desarrollosocial.cl
    DocumentRoot /var/www/html/habitabilidad/frontend/dist
    ServerName habitabilidad.mideplan.cl
    ServerAlias habitabilidad.mideplan.cl
    ErrorLog logs/habitabilidad.mideplan.cl-error_log
    CustomLog logs/habitabilidad.mideplan.cl-access_log common
    Options Indexes FollowSymLinks

    <Directory "/var/www/html/habitabilidad/frontend/dist">
        AllowOverride All
        <IfVersion < 2.4>
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
    </Directory>
</VirtualHost>


